Metadata-Version: 2.4
Name: my-project
Version: 0.1.0
Summary: Template Python project with stranske/Workflows CI integration
Author-email: Your Name <your.email@example.com>
License: MIT
Project-URL: Homepage, https://github.com/stranske/Template
Project-URL: Repository, https://github.com/stranske/Template
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Requires-Python: >=3.11
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pydantic<3,>=2.7
Requires-Dist: PyYAML<7,>=6.0.2
Provides-Extra: dev
Requires-Dist: pytest==9.0.2; extra == "dev"
Requires-Dist: pytest-cov==7.0.0; extra == "dev"
Requires-Dist: ruff==0.15.0; extra == "dev"
Requires-Dist: mypy==1.19.1; extra == "dev"
Dynamic: license-file

# Counter_Risk

A programmatic replacement for the MOSERS spreadsheet workflow used to evaluate counterparty risk and produce the monthly Counterparty Exposure reporting package (Excel workbooks + PowerPoint).

## Who this is for

- **Operators (non-technical):** run the monthly process via a button-driven Runner (Excel or a simple Windows app) and deliver the output files. Operators do not need repo access.
- **Maintainers:** develop and maintain the pipeline in this repository, primarily through agent-driven issues and PRs.

## What the pipeline produces

- Updated historical Excel workbooks (time series inputs for charts)
- Updated monthly PowerPoint (screenshots replaced + chart links refreshed)
- A run folder with a manifest (inputs, hashes, warnings, summaries)
- Optional ‚Äúdistribution‚Äù deliverables (static PPT/PDF) that do not prompt for link refresh

## Start here

- **Project agent guide:** [AGENTS.md](AGENTS.md)
- **Consumer repo workflow rules:** [CLAUDE.md](CLAUDE.md)
- **How to use labels/keepalive/autopilot:** [WORKFLOW_USER_GUIDE.md](WORKFLOW_USER_GUIDE.md)
- **Issue formatting standard:** [docs/AGENT_ISSUE_FORMAT.md](docs/AGENT_ISSUE_FORMAT.md)
- **CI/Workflows integration guide:** [docs/CI_SYSTEM_GUIDE.md](docs/CI_SYSTEM_GUIDE.md)
- **Keepalive troubleshooting:** [docs/KEEPALIVE_TROUBLESHOOTING.md](docs/KEEPALIVE_TROUBLESHOOTING.md)
- **Consumer setup checklist:** [docs/SETUP_CHECKLIST.md](docs/SETUP_CHECKLIST.md)

## Repository automation (high level)

This repo is integrated with the central [stranske/Workflows](https://github.com/stranske/Workflows) library.

Typical maintainer loop:

1. Write/format an issue using the repo issue format.
2. Label the issue to trigger agent workflows (for example, `agents:format` then `agent:codex`).
3. Keepalive iterates on the PR until tasks and acceptance criteria are complete.

If a change requires editing synced workflow files, do it in **stranske/Workflows** first and then sync.

## Testing
Autopilot smoke tests are enabled to validate basic keepalive and automation flow behavior.

## Development
Use these maintainer commands from the repository root:

- `make lint` runs `ruff check src/ tests/`
- `make format` runs `ruff format src/ tests/`
- `make test` runs `pytest -m "not slow"`

## Features

- üêç **Python 3.11+** - Modern Python with type hints
- üîß **Ruff** - Fast Python linting and formatting
- üîç **MyPy** - Strict type checking
- üß™ **Pytest** - Testing with 80% coverage requirement
- ü§ñ **CLI Codex Automation** - Gate-triggered keepalive for automated development
- üîÑ **Dual Checkout Pattern** - Consumer repo + centralized Workflows scripts

## Workflows

This repository uses reusable workflows from [stranske/Workflows](https://github.com/stranske/Workflows):

### Core CI & Quality

| Workflow | Purpose | Trigger |
|----------|---------|---------|
| **Gate** | PR validation (CI, lint, tests) | Pull request |
| **CI** | Push-to-main continuous integration | Push to main |
| **Autofix** | Automatic lint/format fixes | Label: `autofix` |

### Agent Workflows (CLI Codex)

| Workflow | Purpose | Trigger |
|----------|---------|---------|
| **Keepalive Loop** | Runs Codex CLI after Gate passes | Gate completion, PR label |
| **PR Meta** | Updates PR status summaries | PR events |
| **Issue Intake** | Creates PRs from labeled issues | Issue labeled |
| **Guard** | Security checks for agent execution | Before agent runs |
| **Bot Comment Handler** | Processes @codex commands | Issue comments |
| **Autofix Loop** | Autofix integration with keepalive | Autofix + agent label |

**Note:** `agents-orchestrator.yml` is legacy and can be removed. The current architecture uses `agents-keepalive-loop.yml` which integrates with the Gate workflow for event-driven triggering.

## Agent Automation

This template uses the **Gate-triggered keepalive** architecture:

### How It Works

1. **Create Issue** with structured Scope/Tasks/Acceptance sections
2. **Label Issue** with `agent:codex`
3. **Issue Intake** creates PR from issue
4. **Gate Workflow** runs CI validation
5. **Keepalive Loop** triggers after Gate completion
   - Evaluates eligibility (unchecked tasks, no pause labels)
   - Runs CLI Codex via `reusable-codex-run.yml`
   - Codex implements changes and pushes commits
6. **Gate Runs Again** ‚Üí loop continues
7. **Completion** when all acceptance criteria checked

### Key Components

- **Activation**: PR must have `agent:codex` label, Gate success, unchecked tasks
- **Task Tracking**: Agent updates checkboxes in PR body after completing work
- **Progress Detection**: Automatic checkbox reconciliation via session analysis
- **Failure Handling**: After 3 failures, adds `needs-human` label and pauses
- **Concurrency**: One keepalive run per PR (configurable via `agents:max-parallel:N`)

### Control Labels

| Label | Effect |
|-------|--------|
| `agent:codex` | Enables Codex automation |
| `agents:pause` | Halts all agent activity |
| `needs-human` | Auto-added after failures, blocks keepalive |
| `agents:max-parallel:N` | Override concurrent run limit (default: 1) |

### Using Issues.txt

Add issues to `Issues.txt` using the structured format, then trigger the intake workflow:

```
1) Issue title here
Labels: agent:codex, enhancement

## Scope
Explanation of what needs to be done and why.

## Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

## Acceptance Criteria
- [ ] All tests pass
- [ ] Code is documented
- [ ] Coverage ‚â•80%

Implementation notes
- Technical details or constraints
```

## Troubleshooting

### Keepalive Not Triggering

- Verify PR has `agent:codex` label
- Check Gate workflow passed
- Ensure PR body has unchecked tasks
- Look for `agents:pause` or `needs-human` labels
- Review keepalive summary comment for skip reasons

### No Automated Status Summary

- Verify issue has Scope/Tasks/Acceptance sections
- Run `agents-pr-meta.yml` manually
- Check PR links to source issue

### Agent Failures

After 3 failures, keepalive pauses and adds `needs-human`:
1. Review failure reason in keepalive summary
2. Fix the issue (code, prompt, auth)
3. Remove `needs-human` label to resume

### Permission Errors

- Verify `CODEX_AUTH_JSON` or GitHub App credentials are set
- Check environment `agent-standard` exists
- Ensure PATs have required scopes: `repo`, `workflow`

## Documentation

- [Workflows Repo](https://github.com/stranske/Workflows) - Central workflow library
- [Consumer README](https://github.com/stranske/Workflows/blob/main/templates/consumer-repo/README.md) - Complete setup guide
- [Keepalive Architecture](https://github.com/stranske/Workflows/blob/main/docs/keepalive/GoalsAndPlumbing.md) - Detailed design
- [Setup Checklist](docs/keepalive/SETUP_CHECKLIST.md) - Step-by-step configuration

## Testing
Autopilot smoke tests are enabled to validate basic keepalive and automation flow behavior.

## License

MIT License - see [LICENSE](LICENSE) for details.
