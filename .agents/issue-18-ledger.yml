version: 1
issue: 18
base: main
branch: codex/issue-18
tasks:
  - id: task-01
    title: Create `src/counter_risk/writers/historical_update.py`.
    status: doing
    started_at: '2026-02-13T05:40:20Z'
    finished_at: null
    commit: ''
    notes: []
  - id: task-02
    title: 'Define scope for: Create the file `src/counter_risk/writers/historical_update.py`
      with module-level docstring (verify: docs updated)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-03
    title: 'Implement focused slice for: Create the file `src/counter_risk/writers/historical_update.py`
      with module-level docstring (verify: docs updated)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-04
    title: 'Validate focused slice for: Create the file `src/counter_risk/writers/historical_update.py`
      with module-level docstring (verify: docs updated)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-05
    title: 'Create the file `src/counter_risk/writers/historical_update.py` with imports
      (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-06
    title: 'Define scope for: Define the module structure including any shared helper
      functions for Excel workbook manipulation (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-07
    title: 'Implement focused slice for: Define the module structure including any
      shared helper functions for Excel workbook manipulation (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-08
    title: 'Validate focused slice for: Define the module structure including any
      shared helper functions for Excel workbook manipulation (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-09
    title: 'Add error handling classes or constants needed for validation failures
      (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-10
    title: Implement `append_row_all_programs(...)` in `src/counter_risk/writers/historical_update.py`.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-11
    title: 'Define scope for: Define the function signature for `append_row_all_programs`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-12
    title: 'Implement focused slice for: Define the function signature for `append_row_all_programs`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-13
    title: 'Validate focused slice for: Define the function signature for `append_row_all_programs`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-14
    title: 'Define the function signature for `append_row_all_programs` including
      rollup data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-15
    title: 'Define scope for: Define the function signature for `append_row_all_programs`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-16
    title: 'Implement focused slice for: Define the function signature for `append_row_all_programs`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-17
    title: 'Validate focused slice for: Define the function signature for `append_row_all_programs`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-18
    title: 'Implement logic to locate the ''All Programs 3 Year'' sheet (verify: confirm
      completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-19
    title: 'find the last row (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-20
    title: 'Define scope for: Implement column mapping for Total, Total x-clearing,
      Cash, Class, TIPS, Nominal, Equity, Currency, (verify: confirm completion in
      repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-21
    title: 'Implement focused slice for: Implement column mapping for Total, Total
      x-clearing, Cash, Class, TIPS, Nominal, Equity, Currency, (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-22
    title: 'Validate focused slice for: Implement column mapping for Total, Total
      x-clearing, Cash, Class, TIPS, Nominal, Equity, Currency, (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-23
    title: 'Commodity series (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-24
    title: 'Add logic to write the new row with proper date (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-25
    title: 'Define scope for: Add logic to write the new row with numeric values from
      rollup data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-26
    title: 'Implement focused slice for: Add logic to write the new row with numeric
      values from rollup data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-27
    title: 'Validate focused slice for: Add logic to write the new row with numeric
      values from rollup data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-28
    title: Implement `append_row_ex_trend(...)` in `src/counter_risk/writers/historical_update.py`.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-29
    title: 'Define scope for: Define the function signature for `append_row_ex_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-30
    title: 'Implement focused slice for: Define the function signature for `append_row_ex_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-31
    title: 'Validate focused slice for: Define the function signature for `append_row_ex_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-32
    title: 'Define the function signature for `append_row_ex_trend` including rollup
      data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-33
    title: 'Define scope for: Define the function signature for `append_row_ex_trend`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-34
    title: 'Implement focused slice for: Define the function signature for `append_row_ex_trend`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-35
    title: 'Validate focused slice for: Define the function signature for `append_row_ex_trend`
      including and optional date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-36
    title: 'Implement logic to locate the ''ex LLC 3 Year'' sheet (verify: confirm
      completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-37
    title: 'Implement column mapping for Total, Class, TIPS, Nominal, Equity, Commodity,
      (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-38
    title: 'Currency series (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-39
    title: Implement `append_row_trend(...)` in `src/counter_risk/writers/historical_update.py`.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-40
    title: 'Define scope for: Define the function signature for `append_row_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-41
    title: 'Implement focused slice for: Define the function signature for `append_row_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-42
    title: 'Validate focused slice for: Define the function signature for `append_row_trend`
      including parameters for workbook path (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-43
    title: 'Define the function signature for `append_row_trend` including rollup
      data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-44
    title: 'Define the function signature for `append_row_trend` including and optional
      date (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-45
    title: 'Implement logic to locate the ''LLC 3 Year'' sheet (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-46
    title: 'Implement column mapping for Total, Class, Nominal, Equity, Commodity,
      (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-47
    title: Add date handling in `src/counter_risk/writers/historical_update.py` to
      default appended date to config `as_of_date` (or infer from MOSERS CPRS-CH header).
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-48
    title: Add validation in `src/counter_risk/writers/historical_update.py` to ensure
      the appended date is newer than the last row date; raise a clear error if not.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-49
    title: Implement header-based column lookup in `src/counter_risk/writers/historical_update.py`
      and write `0` for any missing series headers.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-50
    title: 'Implement a function to read (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-51
    title: 'parse column headers from an Excel sheet into a mapping dictionary (verify:
      confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-52
    title: 'Define scope for: Add logic to match expected series names to actual column
      positions using the header mapping (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-53
    title: 'Implement focused slice for: Add logic to match expected series names
      to actual column positions using the header mapping (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-54
    title: 'Validate focused slice for: Add logic to match expected series names to
      actual column positions using the header mapping (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-55
    title: 'Define scope for: Implement fallback logic to write zero values when a
      series is not found in the computed rollups (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-56
    title: 'Implement focused slice for: Implement fallback logic to write zero values
      when a series is not found in the computed rollups (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-57
    title: 'Validate focused slice for: Implement fallback logic to write zero values
      when a series is not found in the computed rollups (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-58
    title: 'Define scope for: Add logging or warnings when series columns are missing
      from the target sheet headers (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-59
    title: 'Implement focused slice for: Add logging or warnings when series columns
      are missing from the target sheet headers (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-60
    title: 'Validate focused slice for: Add logging or warnings when series columns
      are missing from the target sheet headers (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-61
    title: Write tests to assert each target sheet has exactly one new appended row
      after running the update.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-62
    title: 'Define scope for: Create test fixtures with sample Excel workbooks containing
      the three target sheets with existing data (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-63
    title: 'Implement focused slice for: Create test fixtures with sample Excel workbooks
      containing the three target sheets with existing data (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-64
    title: 'Validate focused slice for: Create test fixtures with sample Excel workbooks
      containing the three target sheets with existing data (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-65
    title: 'Define scope for: Write a test that loads a fixture workbook, runs all
      three append functions, (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-66
    title: 'Implement focused slice for: Write a test that loads a fixture workbook,
      runs all three append functions, (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-67
    title: 'Validate focused slice for: Write a test that loads a fixture workbook,
      runs all three append functions, (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-68
    title: 'verifies row count increased by one (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-69
    title: 'Define scope for: Add assertions to verify the date column in the new
      row matches the expected as_of_date'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-70
    title: 'Implement focused slice for: Add assertions to verify the date column
      in the new row matches the expected as_of_date'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-71
    title: 'Validate focused slice for: Add assertions to verify the date column in
      the new row matches the expected as_of_date'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-72
    title: 'Define scope for: Implement cleanup logic to ensure test workbooks are
      properly closed after each test (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-73
    title: 'Implement focused slice for: Implement cleanup logic to ensure test workbooks
      are properly closed after each test (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-74
    title: 'Validate focused slice for: Implement cleanup logic to ensure test workbooks
      are properly closed after each test (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-75
    title: Write tests to assert at least one known series value in the appended row
      matches computed rollups.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-76
    title: 'Define scope for: Create test fixtures with known rollup data for at least
      two series per sheet type (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-77
    title: 'Implement focused slice for: Create test fixtures with known rollup data
      for at least two series per sheet type (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-78
    title: 'Validate focused slice for: Create test fixtures with known rollup data
      for at least two series per sheet type (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-79
    title: 'Write tests that append rows using the fixture rollup data (verify: tests
      pass)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-80
    title: 'read back the written values (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-81
    title: 'Define scope for: Add assertions comparing written values to expected
      rollup values with appropriate numeric precision (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-82
    title: 'Implement focused slice for: Add assertions comparing written values to
      expected rollup values with appropriate numeric precision (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-83
    title: 'Validate focused slice for: Add assertions comparing written values to
      expected rollup values with appropriate numeric precision (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-84
    title: 'Test edge cases including zero values (verify: confirm completion in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-85
    title: 'Test edge cases including negative values (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-86
    title: 'Test edge cases including and very large numbers (verify: confirm completion
      in repo)'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-87
    title: Updated output workbooks can be saved and reloaded without errors.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-88
    title: Each target sheet receives exactly one appended row.
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-89
    title: The appended row contains no blanks in numeric series columns (missing
      series values are written as `0`).
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-90
    title: Add `src/counter_risk/writers/historical_update.py`
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-91
    title: Implement `append_row_all_programs(...)`
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-92
    title: Implement `append_row_ex_trend(...)`
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-93
    title: Implement `append_row_trend(...)`
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-94
    title: 'Date handling:'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-95
    title: Default appended date = config `as_of_date` (or infer from MOSERS CPRS-CH
      header)
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-96
    title: Validate date is newer than last row; fail with clear error if not
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-97
    title: Lookup series columns by header name; write 0 for missing
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-98
    title: 'Add tests that:'
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-99
    title: append exactly one row per sheet
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-100
    title: verify at least one known series value matches computed rollups
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-101
    title: Output workbooks save + reload without errors
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-102
    title: Each target sheet receives exactly one appended row
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
  - id: task-103
    title: Appended row has no blanks in numeric series columns (use 0 instead)
    status: todo
    started_at: null
    finished_at: null
    commit: ''
    notes: []
